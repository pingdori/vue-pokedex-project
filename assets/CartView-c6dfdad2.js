import{_ as $,r as f,o as u,c as h,b as n,a as t,F as k,q as S,u as b,t as m,e as L,x as y,w as M,d as C,y as v}from"./index-8c283e9c.js";const{VITE_APP_URL:r,VITE_APP_PATH:d}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"pokebox",BASE_URL:"/vue-pokedex-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},P={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{getProducts(){const e=`${r}api/${d}/products`;this.isLoading=!0,this.$http.get(e).then(s=>{this.products=s.data.products,this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.$httpMessageState(s.response,"錯誤訊息")})},getProduct(e){this.$router.push(`/user/product/${e}`)},addToCart(e,s=1){this.isLoading=!0;const l=`${r}api/${d}/cart`;this.status.loadingItem=e;const p={product_id:e,qty:s};this.$http.post(l,{data:p}).then(o=>{this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(o=>{this.isLoading=!1})},deleteAllCarts(){this.isLoading=!0;const e=`${r}api/${d}/carts`;this.$http.delete(e).then(s=>{console.log(s,"清除購物車"),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.$httpMessageState(s.response,"清除購物車")})},getCart(){const e=`${r}api/${d}/cart`;this.isLoading=!0,this.$http.get(e).then(s=>{this.cart=s.data.data,console.log("購物車",s),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.$httpMessageState(s.response,"錯誤訊息")})},removeCartItem(e){this.status.loadingItem=e;const s=`${r}api/${d}/cart/${e}`;this.isLoading=!0,this.$http.delete(s).then(l=>{this.$httpMessageState(l,"移除購物車品項"),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(l=>{this.isLoading=!1,this.$httpMessageState(l.response,"移除購物車品項")})},updateCart(e){this.isLoading=!0;const s=`${r}api/${d}/cart/${e.id}`,l={product_id:e.product_id,qty:e.qty};this.$http.put(s,{data:l}).then(p=>{this.$httpMessageState(p,"更新購物車"),this.isLoading=!1,this.getCart()}).catch(p=>{this.isLoading=!1,this.$httpMessageState(p.response,"更新購物車")})},addCouponCode(){const e=`${r}api/${d}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.$http.post(e,{data:s}).then(l=>{this.$httpMessageState(l,"加入優惠券"),this.getCart(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.$httpMessageState(l.response,"加入優惠券")})},createOrder(){this.isLoading=!0;const e=`${r}api/${d}/order`,s=this.form;this.$http.post(e,{data:s}).then(l=>{this.$httpMessageState(l,"建立訂單"),this.$router.push(`/user/checkout/${l.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.$httpMessageState(l.response,"建立訂單")})}},created(){this.getProducts(),this.getCart()}},I={key:0,class:"container"},E={class:"mt-4"},U={class:"text-end"},A={class:"table align-middle"},q=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"110px"}},"數量"),t("th",null,"單價")])],-1),T=["disabled","onClick"],w=t("i",{class:"bi bi-x"},null,-1),F=[w],B={key:0,class:"text-success"},D={class:"input-group input-group-sm"},R=["onUpdate:modelValue","onBlur"],N={class:"input-group-text"},O={class:"text-end"},j={key:0,class:"text-success"},z=t("td",{colspan:"3",class:"text-end"},"總計",-1),H={class:"text-end"},G={key:0},J=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),K={class:"text-end text-success"},Q={class:"input-group mb-3 input-group-sm"},W={class:"input-group-append"},X={class:"my-5 row justify-content-center"},Y={class:"mb-3"},Z=t("label",{for:"email",class:"form-label"},"Email",-1),tt={class:"mb-3"},st=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),et={class:"mb-3"},ot=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),at={class:"mb-3"},lt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),it={class:"mb-3"},nt=t("label",{for:"message",class:"form-label"},"留言",-1),rt=t("div",{class:"text-end"},[t("button",{class:"btn btn-danger"},"送出訂單")],-1),dt={key:1,class:"row align-items-start"};function ct(e,s,l,p,o,c){const x=f("Loading"),_=f("Field"),g=f("ErrorMessage"),V=f("Form");return o.cart.total>0?(u(),h("div",I,[n(x,{active:o.isLoading,"z-index":1060},null,8,["active"]),t("div",E,[t("div",U,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...a)=>c.deleteAllCarts&&c.deleteAllCarts(...a))}," 清空購物車 ")]),t("table",A,[q,t("tbody",null,[o.cart.carts?(u(!0),h(k,{key:0},S(o.cart.carts,a=>(u(),h("tr",{key:a.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:o.status.loadingItem===a.id,onClick:i=>c.removeCartItem(a.id)},F,8,T)]),t("td",null,[C(m(a.product.title)+" ",1),a.coupon?(u(),h("div",B,"已套用優惠券")):b("",!0)]),t("td",null,[t("div",D,[L(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":i=>a.qty=i,onBlur:i=>c.updateCart(a)},null,40,R),[[y,a.qty,void 0,{number:!0}]]),t("div",N,"/ "+m(a.product.unit),1)])]),t("td",O,[o.cart.final_total!==o.cart.total?(u(),h("small",j,"折扣價：")):b("",!0),C(" "+m(e.$filters.currency(a.final_total)),1)])]))),128)):b("",!0)]),t("tfoot",null,[t("tr",null,[z,t("td",H,m(e.$filters.currency(o.cart.total)),1)]),o.cart.final_total!==o.cart.total?(u(),h("tr",G,[J,t("td",K,m(e.$filters.currency(o.cart.final_total)),1)])):b("",!0)])]),t("div",Q,[L(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=a=>o.coupon_code=a),placeholder:"請輸入優惠碼"},null,512),[[y,o.coupon_code]]),t("div",W,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...a)=>c.addCouponCode&&c.addCouponCode(...a))}," 套用優惠碼 ")])])]),t("div",X,[n(V,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:M(({errors:a})=>[t("div",Y,[Z,n(_,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=i=>o.form.user.email=i)},null,8,["class","modelValue"]),n(g,{name:"email",class:"invalid-feedback"})]),t("div",tt,[st,n(_,{id:"name",name:"姓名",type:"text",class:v(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=i=>o.form.user.name=i)},null,8,["class","modelValue"]),n(g,{name:"姓名",class:"invalid-feedback"})]),t("div",et,[ot,n(_,{id:"tel",name:"電話",type:"tel",class:v(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=i=>o.form.user.tel=i)},null,8,["class","modelValue"]),n(g,{name:"電話",class:"invalid-feedback"})]),t("div",at,[lt,n(_,{id:"address",name:"地址",type:"text",class:v(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=i=>o.form.user.address=i)},null,8,["class","modelValue"]),n(g,{name:"地址",class:"invalid-feedback"})]),t("div",it,[nt,L(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=i=>o.form.message=i)},null,512),[[y,o.form.message]])]),rt]),_:1},8,["onSubmit"])])])):(u(),h("div",dt,"購物車無物品"))}const ht=$(P,[["render",ct]]);export{ht as default};
